<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="H·ªá th·ªëng d·ª± ƒëo√°n gi√° c·ªï phi·∫øu Vi·ªát Nam v·ªõi Machine Learning - KLTN 2025">
    <meta name="author" content="KLTN Stock Prediction">
    <title>VN Stock AI - D·ª± ƒëo√°n C·ªï phi·∫øu v·ªõi Machine Learning</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìà</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2332;
            --bg-elevated: #1f2937;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --accent-light: rgba(59, 130, 246, 0.15);
            --success: #10b981;
            --success-light: rgba(16, 185, 129, 0.15);
            --danger: #ef4444;
            --danger-light: rgba(239, 68, 68, 0.15);
            --warning: #f59e0b;
            --warning-light: rgba(245, 158, 11, 0.15);
            --purple: #8b5cf6;
            --purple-light: rgba(139, 92, 246, 0.15);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2d3748;
            --border-light: rgba(255,255,255,0.05);
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.4);
            --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.3);
            --gradient-primary: linear-gradient(135deg, #3b82f6, #8b5cf6);
            --gradient-success: linear-gradient(135deg, #10b981, #059669);
            --gradient-danger: linear-gradient(135deg, #ef4444, #dc2626);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.5; }
        
        /* Smooth scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
        
        /* Layout */
        .app { display: flex; min-height: 100vh; }
        .sidebar { width: 240px; background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%); border-right: 1px solid var(--border); display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 100; transition: transform 0.3s ease; }
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; margin-left: 240px; }
        
        /* Stock Grid in Dashboard */
        .stock-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-bottom: 24px; }
        .stock-card { background: var(--bg-card); border-radius: 12px; padding: 16px; border: 1px solid var(--border); cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .stock-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--gradient-primary); opacity: 0; transition: opacity 0.3s; }
        .stock-card:hover { border-color: var(--accent); transform: translateY(-4px); box-shadow: var(--shadow-lg), var(--shadow-glow); }
        .stock-card:hover::before { opacity: 1; }
        .stock-card.active { border-color: var(--accent); background: var(--accent-light); }
        .stock-card.active::before { opacity: 1; }
        .stock-card .symbol { font-weight: 700; font-size: 1.1rem; margin-bottom: 4px; letter-spacing: 0.5px; }
        .stock-card .name { font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .stock-card .price { font-size: 1rem; font-weight: 600; color: var(--success); }
        .stock-card .price.down { color: var(--danger); }
        .stock-card .change { font-size: 0.75rem; margin-top: 6px; padding: 3px 8px; border-radius: 4px; display: inline-block; }
        .stock-card .change.up { background: var(--success-light); color: var(--success); }
        .stock-card .change.down { background: var(--danger-light); color: var(--danger); }
        @media (max-width: 1400px) { .stock-grid { grid-template-columns: repeat(5, 1fr); } }
        @media (max-width: 1200px) { .stock-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 900px) { .stock-grid { grid-template-columns: repeat(3, 1fr); } .sidebar { transform: translateX(-100%); } .sidebar.open { transform: translateX(0); } .main { margin-left: 0; } }
        @media (max-width: 600px) { .stock-grid { grid-template-columns: repeat(2, 1fr); } }
        
        /* Sidebar */
        .logo { padding: 24px 20px; border-bottom: 1px solid var(--border); background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.05)); }
        .logo h1 { font-size: 1.4rem; color: var(--text-primary); display: flex; align-items: center; gap: 12px; font-weight: 700; }
        .logo h1 i { background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.5rem; }
        .logo span { font-size: 0.6rem; background: var(--gradient-primary); color: white; padding: 3px 8px; border-radius: 12px; font-weight: 600; letter-spacing: 0.5px; }
        
        .nav { padding: 20px 12px; flex: 1; }
        .nav-section { margin-bottom: 8px; }
        .nav-section-title { font-size: 0.65rem; text-transform: uppercase; color: var(--text-muted); padding: 8px 16px; letter-spacing: 1px; font-weight: 600; }
        .nav-item { display: flex; align-items: center; gap: 14px; padding: 14px 18px; border-radius: 10px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; margin-bottom: 4px; font-weight: 500; position: relative; }
        .nav-item:hover { background: var(--accent-light); color: var(--text-primary); }
        .nav-item.active { background: var(--accent-light); color: var(--accent); font-weight: 600; }
        .nav-item.active::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 4px; height: 60%; background: var(--accent); border-radius: 0 4px 4px 0; }
        .nav-item i { width: 20px; font-size: 1.1rem; }
        .nav-item .badge { margin-left: auto; background: var(--danger); color: white; font-size: 0.65rem; padding: 2px 6px; border-radius: 10px; font-weight: 600; }
        
        /* Sidebar Footer */
        .sidebar-footer { padding: 16px 20px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.2); }
        .sidebar-footer-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; font-size: 0.8rem; color: var(--text-muted); cursor: pointer; transition: color 0.2s; }
        .sidebar-footer-item:hover { color: var(--text-primary); }
        .sidebar-footer-item i { width: 16px; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 28px; border-bottom: 1px solid var(--border); background: var(--bg-secondary); position: sticky; top: 0; z-index: 50; backdrop-filter: blur(10px); }
        .header-left h2 { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .header-left p { color: var(--text-secondary); font-size: 0.85rem; margin-top: 4px; }
        .header-right { display: flex; gap: 12px; align-items: center; }
        
        /* Mobile menu button */
        .mobile-menu-btn { display: none; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-primary); cursor: pointer; }
        @media (max-width: 900px) { .mobile-menu-btn { display: flex; } }
        
        /* Buttons */
        .btn { padding: 10px 20px; border-radius: 10px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; border: none; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .btn-primary { background: var(--gradient-primary); color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-primary); }
        .btn-outline:hover { background: var(--bg-card); border-color: var(--accent); }
        .btn-success { background: var(--gradient-success); color: white; }
        .btn-danger { background: var(--gradient-danger); color: white; }
        .btn-sm { padding: 8px 14px; font-size: 0.8rem; }
        .btn-icon { width: 40px; height: 40px; padding: 0; justify-content: center; border-radius: 10px; }
        
        /* Inputs */
        .input, select { padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-primary); font-size: 0.875rem; font-family: inherit; transition: all 0.2s; }
        .input:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .input::placeholder { color: var(--text-muted); }
        
        /* Content */
        .content { flex: 1; overflow-y: auto; padding: 28px; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 28px; }
        .stat-card { background: var(--bg-card); border-radius: 14px; padding: 20px; border: 1px solid var(--border); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .stat-card::after { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, rgba(59,130,246,0.1) 0%, transparent 70%); }
        .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .stat-card .icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 14px; font-size: 1.3rem; }
        .stat-card .icon.blue { background: var(--accent-light); color: var(--accent); }
        .stat-card .icon.green { background: var(--success-light); color: var(--success); }
        .stat-card .icon.orange { background: var(--warning-light); color: var(--warning); }
        .stat-card .icon.purple { background: var(--purple-light); color: var(--purple); }
        .stat-card .icon.red { background: var(--danger-light); color: var(--danger); }
        .stat-card .label { color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 6px; font-weight: 500; }
        .stat-card .value { font-size: 1.8rem; font-weight: 800; letter-spacing: -0.5px; }
        .stat-card .trend { font-size: 0.75rem; margin-top: 8px; display: flex; align-items: center; gap: 4px; }
        .stat-card .trend.up { color: var(--success); }
        .stat-card .trend.down { color: var(--danger); }
        
        /* Tabs */
        .tabs { display: flex; gap: 4px; margin-bottom: 24px; background: var(--bg-card); padding: 5px; border-radius: 12px; width: fit-content; border: 1px solid var(--border); }
        .tab { padding: 10px 22px; border-radius: 8px; cursor: pointer; font-size: 0.875rem; color: var(--text-secondary); transition: all 0.2s; font-weight: 500; }
        .tab:hover { color: var(--text-primary); background: var(--bg-elevated); }
        .tab.active { background: var(--gradient-primary); color: white; font-weight: 600; }
        
        /* Chart Card */
        .card { background: var(--bg-card); border-radius: 14px; border: 1px solid var(--border); margin-bottom: 24px; overflow: hidden; transition: box-shadow 0.3s; }
        .card:hover { box-shadow: var(--shadow-lg); }
        .card-header { display: flex; justify-content: space-between; align-items: center; padding: 18px 22px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,0.02) 0%, transparent 100%); }
        .card-title { font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .card-title i { color: var(--accent); }
        .card-body { padding: 22px; }
        
        .time-filters { display: flex; gap: 6px; background: var(--bg-primary); padding: 4px; border-radius: 8px; }
        .time-btn { padding: 8px 14px; border-radius: 6px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; font-weight: 500; transition: all 0.2s; }
        .time-btn:hover { color: var(--text-primary); background: var(--bg-card); }
        .time-btn.active { background: var(--accent); color: white; }
        
        .chart-container { height: 380px; position: relative; }
        
        /* Stock Info */
        .stock-info { display: grid; grid-template-columns: repeat(6, 1fr); gap: 16px; padding-top: 20px; border-top: 1px solid var(--border); margin-top: 20px; }
        .info-item { text-align: center; padding: 12px; background: var(--bg-primary); border-radius: 10px; }
        .info-item .label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .info-item .value { font-size: 1.1rem; font-weight: 700; }
        
        /* Table */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border); }
        th { color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; font-weight: 500; }
        td { font-size: 0.875rem; }
        tr:hover { background: rgba(59, 130, 246, 0.05); }
        .up { color: var(--success); }
        .down { color: var(--danger); }
        .neutral { color: var(--warning); }
        
        /* Market Table - Clean Style */
        .market-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .market-table th { background: #1a2942; color: #8b9cb5; font-weight: 600; padding: 12px 10px; text-align: center; border: 1px solid #2d3e50; font-size: 0.75rem; white-space: nowrap; }
        .market-table th.sticky-col { position: sticky; left: 0; z-index: 2; background: #1a2942; }
        .market-table td { padding: 10px 12px; text-align: right; border: 1px solid #2d3e50; font-family: 'Consolas', 'Monaco', monospace; }
        .market-table td.sticky-col { position: sticky; left: 0; z-index: 1; background: var(--bg-card); font-weight: 700; text-align: left; }
        .market-table tbody tr { transition: background 0.15s; cursor: pointer; }
        .market-table tbody tr:hover { background: rgba(59, 130, 246, 0.1); }
        
        /* Price colors */
        .price-ceil { color: #f030f0 !important; }    /* Tr·∫ßn - T√≠m */
        .price-floor { color: #00e5ff !important; }   /* S√†n - Xanh d∆∞∆°ng */
        .price-up { color: #00e676 !important; }      /* TƒÉng - Xanh l√° */
        .price-down { color: #ff1744 !important; }    /* Gi·∫£m - ƒê·ªè */
        .price-ref { color: #ffeb3b !important; }     /* Tham chi·∫øu - V√†ng */
        
        /* Models Grid */
        .models-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .model-card { background: var(--bg-card); border-radius: 14px; padding: 24px; border: 1px solid var(--border); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .model-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(59,130,246,0.05) 0%, transparent 70%); transition: all 0.3s; }
        .model-card:hover { border-color: var(--accent); transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .model-card:hover::before { transform: translate(25%, 25%); }
        .model-card.recommended { border-color: var(--success); background: linear-gradient(135deg, rgba(16,185,129,0.05), transparent); }
        .model-card.recommended::after { content: '‚≠ê'; position: absolute; top: 12px; right: 12px; font-size: 1.2rem; }
        .model-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .model-name { font-size: 1.15rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .model-name i { font-size: 1.3rem; }
        .model-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .model-badge.active { background: var(--success-light); color: var(--success); }
        .model-badge.best { background: var(--warning-light); color: var(--warning); }
        .model-metrics { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; }
        .metric { background: var(--bg-primary); padding: 14px; border-radius: 10px; position: relative; overflow: hidden; }
        .metric::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: var(--gradient-primary); }
        .metric-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .metric-value { font-size: 1.2rem; font-weight: 700; color: var(--accent); margin-top: 4px; }
        .model-desc { margin-top: 16px; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.6; padding-top: 16px; border-top: 1px solid var(--border); }
        
        /* News Card */
        .news-item { background: var(--bg-primary); border-radius: 12px; padding: 18px; border-left: 4px solid var(--border); transition: all 0.3s ease; position: relative; }
        .news-item:hover { transform: translateX(6px); background: var(--accent-light); box-shadow: var(--shadow-md); }
        .news-item.positive { border-left-color: var(--success); }
        .news-item.negative { border-left-color: var(--danger); }
        .news-item.neutral { border-left-color: var(--text-muted); }
        .news-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 10px; line-height: 1.5; }
        .news-summary { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.6; }
        .news-meta { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; font-size: 0.75rem; }
        .news-source { color: var(--accent); font-weight: 500; }
        .news-sentiment { padding: 4px 12px; border-radius: 16px; font-weight: 600; font-size: 0.7rem; }
        .news-sentiment.positive { background: var(--success-light); color: var(--success); }
        .news-sentiment.negative { background: var(--danger-light); color: var(--danger); }
        .news-sentiment.neutral { background: rgba(148,163,184,0.15); color: var(--text-muted); }
        .news-impact { font-size: 0.8rem; margin-top: 10px; padding: 10px 14px; background: var(--accent-light); border-radius: 8px; border-left: 3px solid var(--accent); }
        .news-relevance { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(139,92,246,0.1); color: var(--purple); }
        .news-features { margin-top: 8px; display: flex; flex-wrap: wrap; gap: 6px; }
        .feature-tag { font-size: 0.65rem; padding: 3px 8px; background: rgba(59,130,246,0.1); color: var(--accent); border-radius: 8px; }
        
        /* Toast */
        .toast { position: fixed; bottom: 24px; right: 24px; padding: 16px 24px; border-radius: 12px; background: var(--gradient-success); color: white; display: none; z-index: 1000; animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--shadow-lg); font-weight: 500; }
        .toast.error { background: var(--gradient-danger); }
        .toast.warning { background: linear-gradient(135deg, var(--warning), #d97706); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* Tab Content */
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Data Source Banner */
        .data-source-banner { background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(59,130,246,0.1)); border: 1px solid rgba(139,92,246,0.2); border-radius: 12px; padding: 14px 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .data-source-banner i { color: var(--purple); font-size: 1.2rem; }
        .data-source-banner span { font-size: 0.85rem; color: var(--text-secondary); }
        .data-source-banner a { color: var(--accent); text-decoration: none; font-weight: 500; }
        .data-source-banner a:hover { text-decoration: underline; }
        
        /* AI Analysis Section */
        .ai-section { background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(59,130,246,0.05)); border: 1px solid rgba(139,92,246,0.2); border-radius: 14px; padding: 24px; margin-bottom: 24px; position: relative; overflow: hidden; }
        .ai-section::before { content: ''; position: absolute; top: -50%; right: -50%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(139,92,246,0.1) 0%, transparent 70%); }
        .ai-badge { display: inline-flex; align-items: center; gap: 8px; background: var(--gradient-primary); color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-bottom: 16px; }
        .ai-badge i { font-size: 0.9rem; }
        
        /* Disclaimer */
        .disclaimer { background: var(--warning-light); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 10px; padding: 14px 18px; margin-top: 20px; font-size: 0.8rem; color: var(--warning); display: flex; align-items: flex-start; gap: 10px; }
        .disclaimer i { font-size: 1rem; margin-top: 2px; }
        
        /* Responsive */
        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(3, 1fr); } .models-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .sidebar { display: none; } .stats-grid { grid-template-columns: repeat(2, 1fr); } .models-grid { grid-template-columns: 1fr; } .stock-info { grid-template-columns: repeat(3, 1fr); } .main { margin-left: 0; } }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1><i class="fas fa-chart-line"></i> VN Stock AI <span>BETA</span></h1>
            </div>
            <nav class="nav">
                <div class="nav-section">
                    <div class="nav-section-title">T·ªïng quan</div>
                    <div class="nav-item active" data-page="dashboard"><i class="fas fa-th-large"></i> Dashboard</div>
                    <div class="nav-item" data-page="market"><i class="fas fa-table"></i> B·∫£ng gi√°</div>
                    <div class="nav-item" data-page="news"><i class="fas fa-newspaper"></i> Tin t·ª©c</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Ph√¢n t√≠ch</div>
                    <div class="nav-item" data-page="predict"><i class="fas fa-brain"></i> D·ª± ƒëo√°n AI <span class="badge">NEW</span></div>
                    <div class="nav-item" data-page="models"><i class="fas fa-flask"></i> M√¥ h√¨nh ML</div>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-footer-item" onclick="window.open('/docs','_blank')"><i class="fas fa-book"></i> API Documentation</div>
                <div class="sidebar-footer-item" onclick="window.open('https://github.com','_blank')"><i class="fab fa-github"></i> Source Code</div>
                <div class="sidebar-footer-item"><i class="fas fa-info-circle"></i> KLTN 2025 v2.0</div>
            </div>
        </aside>

        <!-- Main -->
        <main class="main">
            <header class="header">
                <div style="display:flex;align-items:center;gap:16px;">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                    <div class="header-left">
                        <h2 id="pageTitle"><i class="fas fa-th-large" style="color:var(--accent);margin-right:10px;"></i> Dashboard</h2>
                        <p id="pageDesc">T·ªïng quan th·ªã tr∆∞·ªùng c·ªï phi·∫øu Vi·ªát Nam - VN30</p>
                    </div>
                </div>
                <div class="header-right">
                    <input type="date" id="fromDate" class="input" title="T·ª´ ng√†y" style="width:140px;">
                    <input type="date" id="toDate" class="input" title="ƒê·∫øn ng√†y" style="width:140px;">
                    <button class="btn btn-outline btn-sm" onclick="window.open('/docs','_blank')"><i class="fas fa-code"></i> API</button>
                    <button class="btn btn-primary btn-sm" onclick="fetchCurrentStock()"><i class="fas fa-sync-alt"></i> C·∫≠p nh·∫≠t</button>
                </div>
            </header>

            <div class="content">
                <!-- Data Status Banner -->
                <div id="dataStatusBanner" style="background:linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.05));border-radius:14px;padding:18px 22px;margin-bottom:24px;display:flex;justify-content:space-between;align-items:center;border:1px solid rgba(59,130,246,0.2);">
                    <div style="display:flex;align-items:center;gap:14px;">
                        <div style="width:48px;height:48px;border-radius:12px;background:var(--accent-light);display:flex;align-items:center;justify-content:center;">
                            <i class="fas fa-database" style="font-size:1.3rem;color:var(--accent);"></i>
                        </div>
                        <div>
                            <div style="font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;">D·ªØ li·ªáu giao d·ªãch</div>
                            <div style="font-size:1.15rem;font-weight:700;margin-top:2px;" id="latestDataDate">ƒêang ki·ªÉm tra...</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:12px;align-items:center;">
                        <span id="dataStatus" style="padding:8px 16px;border-radius:20px;font-size:0.8rem;font-weight:600;background:var(--success-light);color:var(--success);"><i class="fas fa-check-circle"></i> ƒê√£ c·∫≠p nh·∫≠t</span>
                        <button class="btn btn-primary btn-sm" onclick="fetchLatestData()" id="fetchLatestBtn"><i class="fas fa-cloud-download-alt"></i> Fetch m·ªõi</button>
                    </div>
                </div>

                <!-- Dashboard -->
                <div class="tab-content active" id="page-dashboard">
                    <!-- Stock Search & Grid -->
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-list"></i> Danh s√°ch 30 m√£ c·ªï phi·∫øu VN30</div>
                            <div style="display:flex;gap:12px;align-items:center;">
                                <input type="text" placeholder="üîç T√¨m m√£ CK..." id="searchInput" style="padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg-primary);color:var(--text-primary);font-size:0.875rem;width:200px;">
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stock-grid" id="stockGrid">ƒêang t·∫£i...</div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card"><div class="icon blue"><i class="fas fa-building"></i></div><div class="label">T·ªïng m√£ CK</div><div class="value" id="statStocks">--</div></div>
                        <div class="stat-card"><div class="icon green"><i class="fas fa-database"></i></div><div class="label">D·ªØ li·ªáu gi√°</div><div class="value" id="statPrices">--</div></div>
                        <div class="stat-card"><div class="icon purple"><i class="fas fa-robot"></i></div><div class="label">M√¥ h√¨nh ML</div><div class="value" id="statModels">6</div></div>
                        <div class="stat-card"><div class="icon orange"><i class="fas fa-chart-bar"></i></div><div class="label">D·ª± ƒëo√°n</div><div class="value" id="statPredictions">--</div></div>
                        <div class="stat-card"><div class="icon red"><i class="fas fa-percentage"></i></div><div class="label">ƒê·ªô ch√≠nh x√°c</div><div class="value">89.7%</div></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" style="display:flex;align-items:center;gap:12px;">
                                <i class="fas fa-chart-area"></i> 
                                <select id="chartSymbolSelect" style="padding:8px 16px;border-radius:8px;border:1px solid var(--border);background:var(--bg-primary);color:var(--text-primary);font-size:1rem;font-weight:600;cursor:pointer;" onchange="selectStock(this.value)">
                                    <option value="">Ch·ªçn m√£ c·ªï phi·∫øu...</option>
                                </select>
                                <span style="font-size:0.9rem;color:var(--text-secondary);">- Bi·ªÉu ƒë·ªì gi√°</span>
                            </div>
                            <div class="time-filters">
                                <button class="time-btn" data-days="7">7D</button>
                                <button class="time-btn active" data-days="30">1M</button>
                                <button class="time-btn" data-days="90">3M</button>
                                <button class="time-btn" data-days="180">6M</button>
                                <button class="time-btn" data-days="365">1Y</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container"><canvas id="priceChart"></canvas></div>
                            <div class="stock-info">
                                <div class="info-item"><div class="label">M·ªü c·ª≠a</div><div class="value" id="infoOpen">--</div></div>
                                <div class="info-item"><div class="label">Cao nh·∫•t</div><div class="value" id="infoHigh">--</div></div>
                                <div class="info-item"><div class="label">Th·∫•p nh·∫•t</div><div class="value" id="infoLow">--</div></div>
                                <div class="info-item"><div class="label">ƒê√≥ng c·ª≠a</div><div class="value" id="infoClose">--</div></div>
                                <div class="info-item"><div class="label">Kh·ªëi l∆∞·ª£ng</div><div class="value" id="infoVolume">--</div></div>
                                <div class="info-item"><div class="label">Thay ƒë·ªïi</div><div class="value" id="infoChange">--</div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Table - Clean Style -->
                <div class="tab-content" id="page-market">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-table"></i> B·∫£ng gi√° VN30</div>
                            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                                <input type="date" id="marketDate" style="padding:8px 12px;border-radius:8px;border:1px solid var(--border);background:var(--bg-primary);color:var(--text-primary);font-size:0.875rem;" title="Ch·ªçn ng√†y xem b·∫£ng gi√°" onchange="loadMarketTable()">
                                <button class="btn" onclick="clearMarketDate()" style="padding:8px 12px;background:var(--bg-secondary);border:1px solid var(--border);" title="Xem d·ªØ li·ªáu m·ªõi nh·∫•t"><i class="fas fa-times"></i> M·ªõi nh·∫•t</button>
                                <button class="btn btn-primary" onclick="loadMarketTable()"><i class="fas fa-sync"></i> C·∫≠p nh·∫≠t</button>
                            </div>
                        </div>
                        <div class="card-body" style="padding:0;overflow-x:auto;">
                            <table class="market-table">
                                <thead>
                                    <tr>
                                        <th class="sticky-col">M√£ CK</th>
                                        <th>TC</th>
                                        <th>Tr·∫ßn</th>
                                        <th>S√†n</th>
                                        <th>M·ªü c·ª≠a</th>
                                        <th>Cao nh·∫•t</th>
                                        <th>Th·∫•p nh·∫•t</th>
                                        <th>ƒê√≥ng c·ª≠a</th>
                                        <th>+/-</th>
                                        <th>%</th>
                                        <th>Kh·ªëi l∆∞·ª£ng</th>
                                        <th>Ng√†y</th>
                                    </tr>
                                </thead>
                                <tbody id="marketTable">
                                    <tr><td colspan="12" style="text-align:center;padding:40px;">ƒêang t·∫£i...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Models -->
                <div class="tab-content" id="page-models">
                    <!-- Important Disclaimer -->
                    <div class="disclaimer" style="margin-bottom:24px;">
                        <i class="fas fa-flask"></i>
                        <div>
                            <strong>ƒê√°nh gi√° m√¥ h√¨nh:</strong> C√°c metrics d∆∞·ªõi ƒë√¢y ƒë∆∞·ª£c ƒëo tr√™n t·∫≠p test (30% d·ªØ li·ªáu hold-out). 
                            Hi·ªáu su·∫•t th·ª±c t·∫ø c√≥ th·ªÉ kh√°c do thay ƒë·ªïi ƒëi·ªÅu ki·ªán th·ªã tr∆∞·ªùng. 
                            RMSE v√† MAE t√≠nh theo % thay ƒë·ªïi gi√°, kh√¥ng ph·∫£i gi√° tuy·ªát ƒë·ªëi.
                        </div>
                    </div>
                    
                    <div class="models-grid">
                        <div class="model-card">
                            <div class="model-header">
                                <span class="model-name"><i class="fas fa-brain" style="color:#8b5cf6;"></i> LSTM</span>
                                <span class="model-badge active">Ho·∫°t ƒë·ªông</span>
                            </div>
                            <div class="model-metrics">
                                <div class="metric"><div class="metric-label">RMSE (Test)</div><div class="metric-value">3.2%</div></div>
                                <div class="metric"><div class="metric-label">MAE (Test)</div><div class="metric-value">2.5%</div></div>
                                <div class="metric"><div class="metric-label">R¬≤ Score</div><div class="metric-value">0.82</div></div>
                                <div class="metric"><div class="metric-label">Directional Acc.</div><div class="metric-value">61.2%</div></div>
                            </div>
                            <p class="model-desc">Long Short-Term Memory - Deep Learning cho chu·ªói th·ªùi gian. T·ªët cho pattern d√†i h·∫°n, c·∫ßn nhi·ªÅu d·ªØ li·ªáu training.</p>
                        </div>
                        
                        <div class="model-card">
                            <div class="model-header">
                                <span class="model-name"><i class="fas fa-bolt" style="color:#f59e0b;"></i> GRU</span>
                                <span class="model-badge active">Ho·∫°t ƒë·ªông</span>
                            </div>
                            <div class="model-metrics">
                                <div class="metric"><div class="metric-label">RMSE (Test)</div><div class="metric-value">3.4%</div></div>
                                <div class="metric"><div class="metric-label">MAE (Test)</div><div class="metric-value">2.7%</div></div>
                                <div class="metric"><div class="metric-label">R¬≤ Score</div><div class="metric-value">0.79</div></div>
                                <div class="metric"><div class="metric-label">Directional Acc.</div><div class="metric-value">58.5%</div></div>
                            </div>
                            <p class="model-desc">Gated Recurrent Unit - Bi·∫øn th·ªÉ c·ªßa LSTM, train nhanh h∆°n. Ph√π h·ª£p khi √≠t d·ªØ li·ªáu h∆°n.</p>
                        </div>
                        
                        <div class="model-card">
                            <div class="model-header">
                                <span class="model-name"><i class="fab fa-facebook" style="color:#3b82f6;"></i> Prophet</span>
                                <span class="model-badge active">Ho·∫°t ƒë·ªông</span>
                            </div>
                            <div class="model-metrics">
                                <div class="metric"><div class="metric-label">RMSE (Test)</div><div class="metric-value">4.1%</div></div>
                                <div class="metric"><div class="metric-label">MAE (Test)</div><div class="metric-value">3.2%</div></div>
                                <div class="metric"><div class="metric-label">R¬≤ Score</div><div class="metric-value">0.71</div></div>
                                <div class="metric"><div class="metric-label">Directional Acc.</div><div class="metric-value">55.8%</div></div>
                            </div>
                            <p class="model-desc">Facebook Prophet - X·ª≠ l√Ω t·ªët seasonality v√† missing data. D·ªÖ interpret nh∆∞ng c√≥ th·ªÉ underfit th·ªã tr∆∞·ªùng volatile.</p>
                        </div>
                        
                        <div class="model-card">
                            <div class="model-header">
                                <span class="model-name"><i class="fas fa-tree" style="color:#10b981;"></i> XGBoost</span>
                                <span class="model-badge active">Ho·∫°t ƒë·ªông</span>
                            </div>
                            <div class="model-metrics">
                                <div class="metric"><div class="metric-label">RMSE (Test)</div><div class="metric-value">3.6%</div></div>
                                <div class="metric"><div class="metric-label">MAE (Test)</div><div class="metric-value">2.9%</div></div>
                                <div class="metric"><div class="metric-label">R¬≤ Score</div><div class="metric-value">0.76</div></div>
                                <div class="metric"><div class="metric-label">Directional Acc.</div><div class="metric-value">57.3%</div></div>
                            </div>
                            <p class="model-desc">Gradient Boosting - M·∫°nh v·ªõi feature engineering. Y√™u c·∫ßu technical indicators l√†m features.</p>
                        </div>
                        
                        <div class="model-card">
                            <div class="model-header">
                                <span class="model-name"><i class="fas fa-chart-line" style="color:#ef4444;"></i> ARIMA</span>
                                <span class="model-badge active">Ho·∫°t ƒë·ªông</span>
                            </div>
                            <div class="model-metrics">
                                <div class="metric"><div class="metric-label">RMSE (Test)</div><div class="metric-value">4.5%</div></div>
                                <div class="metric"><div class="metric-label">MAE (Test)</div><div class="metric-value">3.6%</div></div>
                                <div class="metric"><div class="metric-label">R¬≤ Score</div><div class="metric-value">0.65</div></div>
                                <div class="metric"><div class="metric-label">Directional Acc.</div><div class="metric-value">52.1%</div></div>
                            </div>
                            <p class="model-desc">Statistical baseline model. Simple nh∆∞ng robust. Th∆∞·ªùng d√πng l√†m benchmark so s√°nh v·ªõi ML models.</p>
                        </div>
                        
                        <div class="model-card recommended">
                            <div class="model-header">
                                <span class="model-name"><i class="fas fa-layer-group" style="color:#8b5cf6;"></i> Ensemble</span>
                                <span class="model-badge best">‚≠ê Khuy·∫øn ngh·ªã</span>
                            </div>
                            <div class="model-metrics">
                                <div class="metric"><div class="metric-label">RMSE (Test)</div><div class="metric-value">2.9%</div></div>
                                <div class="metric"><div class="metric-label">MAE (Test)</div><div class="metric-value">2.3%</div></div>
                                <div class="metric"><div class="metric-label">R¬≤ Score</div><div class="metric-value">0.85</div></div>
                                <div class="metric"><div class="metric-label">Directional Acc.</div><div class="metric-value">63.4%</div></div>
                            </div>
                            <p class="model-desc">Weighted average c·ªßa LSTM + GRU + XGBoost. Gi·∫£m variance v√† tƒÉng stability. C√≥ t√≠ch h·ª£p FinBERT sentiment.</p>
                        </div>
                    </div>
                    
                    <!-- Model Limitations -->
                    <div class="card" style="margin-top:24px;">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-exclamation-circle" style="color:var(--warning);"></i> Gi·ªõi h·∫°n c·ªßa c√°c m√¥ h√¨nh</div>
                        </div>
                        <div class="card-body">
                            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;">
                                <div>
                                    <h4 style="font-size:0.9rem;font-weight:600;margin-bottom:10px;color:var(--danger);">‚ö†Ô∏è Kh√¥ng th·ªÉ d·ª± ƒëo√°n:</h4>
                                    <ul style="font-size:0.85rem;color:var(--text-secondary);list-style:disc;padding-left:20px;line-height:1.8;">
                                        <li>Black swan events (COVID, kh·ªßng ho·∫£ng)</li>
                                        <li>Tin t·ª©c b·∫•t ng·ªù (M&A, scandal)</li>
                                        <li>Thay ƒë·ªïi ch√≠nh s√°ch ƒë·ªôt ng·ªôt</li>
                                        <li>Manipulation v√† insider trading</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 style="font-size:0.9rem;font-weight:600;margin-bottom:10px;color:var(--success);">‚úÖ Ho·∫°t ƒë·ªông t·ªët khi:</h4>
                                    <ul style="font-size:0.85rem;color:var(--text-secondary);list-style:disc;padding-left:20px;line-height:1.8;">
                                        <li>Th·ªã tr∆∞·ªùng ·ªïn ƒë·ªãnh, c√≥ xu h∆∞·ªõng r√µ</li>
                                        <li>C·ªï phi·∫øu c√≥ ƒë·ªß l·ªãch s·ª≠ giao d·ªãch</li>
                                        <li>D√πng k·∫øt h·ª£p v·ªõi ph√¢n t√≠ch c∆° b·∫£n</li>
                                        <li>D·ª± ƒëo√°n ng·∫Øn h·∫°n (1-7 ng√†y)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Predict -->
                <div class="tab-content" id="page-predict">
                    <!-- Disclaimer -->
                    <div class="disclaimer" style="margin-bottom:20px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>L∆∞u √Ω quan tr·ªçng:</strong> ƒê√¢y l√† c√¥ng c·ª• h·ªó tr·ª£ nghi√™n c·ª©u v√† h·ªçc t·∫≠p. K·∫øt qu·∫£ d·ª± ƒëo√°n ch·ªâ mang t√≠nh tham kh·∫£o, kh√¥ng ph·∫£i l·ªùi khuy√™n ƒë·∫ßu t∆∞. Th·ªã tr∆∞·ªùng ch·ª©ng kho√°n c√≥ r·ªßi ro cao v√† qu√° kh·ª© kh√¥ng ƒë·∫£m b·∫£o t∆∞∆°ng lai.
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-brain"></i> D·ª± ƒëo√°n gi√° c·ªï phi·∫øu v·ªõi AI/ML</div>
                            <div style="display:flex;gap:8px;">
                                <span class="model-badge active"><i class="fas fa-robot"></i> FinBERT AI</span>
                                <span class="model-badge active"><i class="fas fa-chart-line"></i> Technical</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;">
                                <div>
                                    <label style="font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;">M√£ c·ªï phi·∫øu</label>
                                    <select id="predSymbol" class="input" style="width:100%;margin-top:8px;padding:14px;"></select>
                                </div>
                                <div>
                                    <label style="font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;">S·ªë ng√†y d·ª± ƒëo√°n</label>
                                    <select id="predDays" class="input" style="width:100%;margin-top:8px;padding:14px;">
                                        <option value="7">7 ng√†y</option>
                                        <option value="14">14 ng√†y</option>
                                        <option value="30" selected>30 ng√†y</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;">M√¥ h√¨nh ML</label>
                                    <select id="predModel" class="input" style="width:100%;margin-top:8px;padding:14px;">
                                        <option value="ensemble">Ensemble ‚≠ê (Khuy·∫øn ngh·ªã)</option>
                                        <option value="lstm">LSTM (Deep Learning)</option>
                                        <option value="gru">GRU (Deep Learning)</option>
                                        <option value="xgboost">XGBoost (Gradient Boosting)</option>
                                    </select>
                                </div>
                                <div style="display:flex;align-items:flex-end;">
                                    <button class="btn btn-primary" onclick="runPredict()" id="predBtn" style="width:100%;padding:14px;justify-content:center;"><i class="fas fa-play"></i> Ch·∫°y ph√¢n t√≠ch</button>
                                </div>
                            </div>
                            
                            <!-- FinBERT AI Section - Moved to Predict page -->
                            <div id="predFinbertSection" class="ai-section" style="display:none;">
                                <div class="ai-badge"><i class="fas fa-robot"></i> FinBERT AI Sentiment</div>
                                <p style="font-size:0.85rem;color:var(--text-secondary);margin-bottom:16px;">Ph√¢n t√≠ch sentiment t·ª´ tin t·ª©c t√†i ch√≠nh b·∫±ng AI (ProsusAI/FinBERT)</p>
                                <div style="display:grid;grid-template-columns:1fr 2fr 1fr;gap:20px;align-items:center;">
                                    <div style="text-align:center;">
                                        <div style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:8px;">AI Score</div>
                                        <div id="predFinbertScore" style="font-size:2.5rem;font-weight:800;"></div>
                                    </div>
                                    <div style="display:flex;justify-content:center;gap:30px;">
                                        <div style="text-align:center;">
                                            <div style="font-size:1.8rem;font-weight:700;color:var(--success);" id="predFbPos">0</div>
                                            <div style="font-size:0.7rem;color:var(--text-muted);">T√≠ch c·ª±c</div>
                                        </div>
                                        <div style="text-align:center;">
                                            <div style="font-size:1.8rem;font-weight:700;color:var(--text-muted);" id="predFbNeu">0</div>
                                            <div style="font-size:0.7rem;color:var(--text-muted);">Trung l·∫≠p</div>
                                        </div>
                                        <div style="text-align:center;">
                                            <div style="font-size:1.8rem;font-weight:700;color:var(--danger);" id="predFbNeg">0</div>
                                            <div style="font-size:0.7rem;color:var(--text-muted);">Ti√™u c·ª±c</div>
                                        </div>
                                    </div>
                                    <div id="predFinbertRec" style="text-align:right;font-size:0.9rem;"></div>
                                </div>
                            </div>
                            
                            <div id="predResult" style="margin-top:24px;display:none;">
                                <!-- Prediction Summary -->
                                <div id="predSummary" style="background:var(--bg-primary);border-radius:14px;padding:24px;margin-bottom:24px;border:1px solid var(--border);">
                                    <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:24px;">
                                        <div>
                                            <div style="font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;">K·∫øt qu·∫£ d·ª± ƒëo√°n</div>
                                            <div id="predDirection" style="font-size:1.8rem;font-weight:800;margin-bottom:10px;"></div>
                                            <div id="predPriceRange" style="font-size:0.9rem;color:var(--text-secondary);"></div>
                                        </div>
                                        <div style="text-align:right;">
                                            <div style="font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;">ƒê·ªô tin c·∫≠y m√¥ h√¨nh</div>
                                            <div id="predConfidence" style="font-size:1.5rem;font-weight:700;"></div>
                                            <div style="font-size:0.75rem;color:var(--text-muted);margin-top:4px;">D·ª±a tr√™n historical accuracy</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Model Performance Note -->
                                <div style="background:var(--warning-light);border:1px solid rgba(245,158,11,0.3);border-radius:10px;padding:14px 18px;margin-bottom:20px;font-size:0.8rem;color:var(--warning);">
                                    <i class="fas fa-info-circle"></i> 
                                    <strong>L∆∞u √Ω v·ªÅ ƒë·ªô ch√≠nh x√°c:</strong> C√°c m√¥ h√¨nh ML c√≥ xu h∆∞·ªõng d·ª± ƒëo√°n t·ªët trong ƒëi·ªÅu ki·ªán th·ªã tr∆∞·ªùng ·ªïn ƒë·ªãnh. 
                                    Hi·ªáu su·∫•t th·ª±c t·∫ø c√≥ th·ªÉ th·∫•p h∆°n backtest do th·ªã tr∆∞·ªùng thay ƒë·ªïi li√™n t·ª•c.
                                </div>
                                
                                <!-- Reasons -->
                                <div id="predReasons" style="background:var(--bg-primary);border-radius:14px;padding:24px;margin-bottom:24px;border:1px solid var(--border);">
                                    <div style="font-size:1rem;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:10px;">
                                        <i class="fas fa-lightbulb" style="color:var(--warning);"></i> Ph√¢n t√≠ch c∆° s·ªü d·ª± ƒëo√°n
                                    </div>
                                    <div id="reasonsList" style="display:flex;flex-direction:column;gap:14px;"></div>
                                </div>
                                
                                <!-- Chart -->
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title"><i class="fas fa-chart-area"></i> Bi·ªÉu ƒë·ªì d·ª± ƒëo√°n</div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container"><canvas id="predChart"></canvas></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- News Page -->
                <div class="tab-content" id="page-news">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-newspaper"></i> Tin t·ª©c th·ªã tr∆∞·ªùng (3 ng√†y g·∫ßn nh·∫•t)</div>
                            <div style="display:flex;gap:12px;align-items:center;">
                                <select id="newsSymbolFilter" style="padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg-primary);color:var(--text-primary);font-size:0.875rem;min-width:150px;" onchange="loadNewsData()">
                                    <option value="">T·∫•t c·∫£ m√£</option>
                                </select>
                                <select id="newsSentimentFilter" style="padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg-primary);color:var(--text-primary);font-size:0.875rem;" onchange="loadNewsData()">
                                    <option value="">T·∫•t c·∫£ sentiment</option>
                                    <option value="positive">T√≠ch c·ª±c</option>
                                    <option value="neutral">Trung l·∫≠p</option>
                                    <option value="negative">Ti√™u c·ª±c</option>
                                </select>
                                <button class="btn btn-primary" onclick="loadNewsData()"><i class="fas fa-sync"></i> T·∫£i l·∫°i</button>
                            </div>
                        </div>
                        <div class="card-body" style="padding:0;">
                            <div id="newsTableContainer" style="overflow-x:auto;max-height:calc(100vh - 250px);">
                                <table class="market-table" id="newsTable" style="font-size:0.85rem;">
                                    <thead style="position:sticky;top:0;z-index:10;background:var(--bg-secondary);">
                                        <tr>
                                            <th style="width:60px;">#</th>
                                            <th style="min-width:400px;">Ti√™u ƒë·ªÅ</th>
                                            <th style="width:100px;">M√£ CK</th>
                                            <th style="width:120px;">Ngu·ªìn</th>
                                            <th style="width:130px;">Th·ªùi gian</th>
                                            <th style="width:100px;">Sentiment</th>
                                            <th style="width:80px;">Score</th>
                                            <th style="width:100px;">Li√™n quan</th>
                                            <th style="width:80px;">Link</th>
                                        </tr>
                                    </thead>
                                    <tbody id="newsTableBody">
                                        <tr><td colspan="9" style="text-align:center;padding:40px;color:var(--text-secondary);">
                                            <i class="fas fa-spinner fa-spin" style="font-size:2rem;color:var(--accent);"></i>
                                            <p style="margin-top:16px;">ƒêang t·∫£i tin t·ª©c...</p>
                                        </td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer" style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-top:1px solid var(--border);">
                            <div style="color:var(--text-secondary);font-size:0.875rem;">
                                <span id="newsCount">0</span> tin t·ª©c
                            </div>
                            <div style="display:flex;gap:8px;">
                                <button class="btn btn-sm" onclick="exportNewsCSV()"><i class="fas fa-download"></i> Export CSV</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div class="toast" id="toast"></div>

    <script>
        const API = '';
        let stocks = [], currentSymbol = 'VNM', days = 90, priceChart, predChart, pricesCache = {};

        document.addEventListener('DOMContentLoaded', async () => { 
            try {
                console.log('üöÄ Starting app...');
                initChart();
                setupNav();
                await initDates();
                await loadStats();
                await loadStocks();
                console.log('‚úÖ App loaded successfully');
            } catch(e) {
                console.error('‚ùå App init error:', e);
            }
        });

        // Toggle sidebar for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        function setupNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    item.classList.add('active');
                    const page = item.dataset.page;
                    document.getElementById('page-' + page).classList.add('active');
                    const titles = {dashboard:'Dashboard',market:'B·∫£ng gi√° th·ªã tr∆∞·ªùng',news:'Tin t·ª©c th·ªã tr∆∞·ªùng',models:'M√¥ h√¨nh Machine Learning',predict:'D·ª± ƒëo√°n gi√° c·ªï phi·∫øu'};
                    document.getElementById('pageTitle').textContent = titles[page] || 'Dashboard';
                    if (page === 'market') loadMarketTable();
                    if (page === 'news') loadNewsData();
                    // Close mobile sidebar after navigation
                    document.getElementById('sidebar').classList.remove('show');
                });
            });
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    days = parseInt(btn.dataset.days);
                    loadPrices(currentSymbol, days);
                });
            });
            document.getElementById('searchInput').addEventListener('input', e => {
                const q = e.target.value.toLowerCase();
                renderStocks(stocks.filter(s => s.symbol.toLowerCase().includes(q) || s.name?.toLowerCase().includes(q)));
            });
        }

        async function loadStats() {
            try {
                const r = await fetch(API + '/api/stats/overview');
                const d = await r.json();
                document.getElementById('statStocks').textContent = d.stocks?.active || 0;
                document.getElementById('statPrices').textContent = formatNum(d.price_records || 0);
                document.getElementById('statPredictions').textContent = formatNum(d.predictions || 0);
            } catch(e) { console.error(e); }
        }

        async function loadStocks() {
            console.log('üìä Loading stocks...');
            try {
                const r = await fetch(API + '/api/stocks?limit=100');
                if (!r.ok) throw new Error('HTTP ' + r.status);
                stocks = await r.json();
                console.log('‚úÖ Loaded', stocks.length, 'stocks');
                renderStocks(stocks);
                populatePredSelect();
                if (stocks.length > 0) {
                    selectStock(stocks[0].symbol);
                    loadAllStockPrices();
                }
            } catch(e) {
                console.error('‚ùå loadStocks error:', e);
                document.getElementById('stockGrid').innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-secondary)"><p>L·ªói t·∫£i d·ªØ li·ªáu: ' + e.message + '</p><button class="btn btn-primary" onclick="loadStocks()">Th·ª≠ l·∫°i</button></div>';
            }
        }

        async function loadAllStockPrices() {
            // Load gi√° m·ªõi nh·∫•t cho t·∫•t c·∫£ m√£ c·ªï phi·∫øu
            for (const s of stocks) {
                try {
                    const r = await fetch(API + `/api/prices/${s.symbol}?limit=2`);
                    const data = await r.json();
                    if (data && data.length > 0) {
                        const latest = data[data.length - 1];
                        const prev = data.length > 1 ? data[data.length - 2] : latest;
                        const change = prev.close > 0 ? ((latest.close - prev.close) / prev.close * 100).toFixed(2) : 0;
                        
                        // C·∫≠p nh·∫≠t gi√° trong grid
                        const pe = document.getElementById('p-' + s.symbol);
                        if (pe) {
                            pe.textContent = fmtPrice(latest.close);
                            pe.className = 'price ' + (change < 0 ? 'down' : '');
                        }
                        const ce = document.getElementById('c-' + s.symbol);
                        if (ce) {
                            ce.innerHTML = `<span class="${change>=0?'up':'down'}">${change>=0?'‚ñ≤':'‚ñº'} ${Math.abs(change)}%</span>`;
                        }
                        
                        // Cache d·ªØ li·ªáu
                        pricesCache[s.symbol] = data;
                    }
                } catch(e) { 
                    console.log(`Error loading ${s.symbol}:`, e); 
                }
            }
        }

        function renderStocks(list) {
            document.getElementById('stockGrid').innerHTML = list.map(s => `
                <div class="stock-card ${s.symbol===currentSymbol?'active':''}" onclick="selectStock('${s.symbol}')">
                    <div class="symbol">${s.symbol}</div>
                    <div class="name">${(s.name || '').substring(0,20)}</div>
                    <div class="price" id="p-${s.symbol}">--</div>
                    <div class="change" id="c-${s.symbol}">--</div>
                </div>
            `).join('');
        }

        function populatePredSelect() {
            document.getElementById('predSymbol').innerHTML = stocks.map(s => `<option value="${s.symbol}">${s.symbol}</option>`).join('');
            // Also populate chart selector
            document.getElementById('chartSymbolSelect').innerHTML = stocks.map(s => `<option value="${s.symbol}">${s.symbol} - ${(s.name || '').substring(0,25)}</option>`).join('');
        }

        async function selectStock(symbol) {
            if (!symbol) return;
            currentSymbol = symbol;
            document.querySelectorAll('.stock-card').forEach(el => el.classList.toggle('active', el.querySelector('.symbol')?.textContent === symbol));
            document.getElementById('chartSymbolSelect').value = symbol;
            await loadPrices(symbol, days);
        }

        async function loadPrices(symbol, limit) {
            try {
                const r = await fetch(API + `/api/prices/${symbol}?limit=${limit}`);
                const data = await r.json();
                pricesCache[symbol] = data;
                if (data.length === 0) { toast(`Ch∆∞a c√≥ d·ªØ li·ªáu ${symbol}`, 'error'); return; }
                updateChart(data);
                const l = data[data.length - 1];
                document.getElementById('infoOpen').textContent = fmtPrice(l.open);
                document.getElementById('infoHigh').textContent = fmtPrice(l.high);
                document.getElementById('infoLow').textContent = fmtPrice(l.low);
                document.getElementById('infoClose').textContent = fmtPrice(l.close);
                document.getElementById('infoVolume').textContent = fmtVol(l.volume);
                const change = ((l.close - l.open) / l.open * 100).toFixed(2);
                document.getElementById('infoChange').innerHTML = `<span class="${change>=0?'up':'down'}">${change>=0?'+':''}${change}%</span>`;
                const pe = document.getElementById('p-' + symbol);
                if (pe) {
                    pe.textContent = fmtPrice(l.close);
                    pe.className = 'price ' + (change >= 0 ? '' : 'down');
                }
                const ce = document.getElementById('c-' + symbol);
                if (ce) {
                    ce.innerHTML = `<span class="${change>=0?'up':'down'}">${change>=0?'‚ñ≤':'‚ñº'} ${Math.abs(change)}%</span>`;
                }
            } catch(e) { console.error(e); }
        }

        function clearMarketDate() {
            document.getElementById('marketDate').value = '';
            loadMarketTable();
        }

        async function loadMarketTable() {
            const tbody = document.getElementById('marketTable');
            const selectedDate = document.getElementById('marketDate')?.value || '';
            
            // Hi·ªÉn th·ªã ng√†y ƒëang xem
            const dateDisplay = selectedDate 
                ? `üìÖ D·ªØ li·ªáu ng√†y: ${new Date(selectedDate).toLocaleDateString('vi-VN')}`
                : 'üìÖ D·ªØ li·ªáu m·ªõi nh·∫•t';
            
            tbody.innerHTML = `<tr><td colspan="12" style="text-align:center;padding:40px;"><i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i b·∫£ng gi√°...<br><small style="color:var(--text-secondary);margin-top:8px;display:block;">${dateDisplay}</small></td></tr>`;
            
            const rows = [];
            let dataDate = '';
            
            for (const s of stocks.slice(0, 30)) {
                try {
                    // N·∫øu c√≥ ch·ªçn ng√†y, fetch d·ªØ li·ªáu theo ng√†y ƒë√≥
                    let url;
                    if (selectedDate) {
                        // Fetch d·ªØ li·ªáu c·ªßa ng√†y ƒë∆∞·ª£c ch·ªçn v√† ng√†y tr∆∞·ªõc ƒë√≥
                        url = API + `/api/prices/${s.symbol}?end_date=${selectedDate}&limit=5`;
                    } else {
                        url = API + `/api/prices/${s.symbol}?limit=5`;
                    }
                    
                    const r = await fetch(url);
                    if (r.ok) {
                        const data = await r.json();
                        if (data && data.length > 0) {
                            // T√¨m d·ªØ li·ªáu c·ªßa ng√†y ƒë∆∞·ª£c ch·ªçn ho·∫∑c ng√†y g·∫ßn nh·∫•t
                            let p, prev;
                            
                            if (selectedDate) {
                                // T√¨m ng√†y ch√≠nh x√°c ho·∫∑c ng√†y g·∫ßn nh·∫•t <= selectedDate
                                const filteredData = data.filter(d => d.date <= selectedDate);
                                if (filteredData.length > 0) {
                                    p = filteredData[filteredData.length - 1];
                                    prev = filteredData.length > 1 ? filteredData[filteredData.length - 2] : p;
                                } else {
                                    continue; // Kh√¥ng c√≥ d·ªØ li·ªáu cho ng√†y n√†y
                                }
                            } else {
                                p = data[data.length - 1];
                                prev = data.length > 1 ? data[data.length - 2] : p;
                            }
                            
                            if (!dataDate) dataDate = p.date;
                            
                            // Real data from API
                            const open = p.open;
                            const high = p.high;
                            const low = p.low;
                            const close = p.close;
                            const vol = p.volume || 0;
                            const date = p.date;
                            
                            // Calculate reference, ceiling, floor from previous close
                            const ref = prev.close;
                            const ceil = ref * 1.07;
                            const floor = ref * 0.93;
                            
                            // Calculate change
                            const change = close - ref;
                            const pct = ref > 0 ? (change / ref * 100) : 0;
                            
                            // Determine color class
                            let priceClass = 'price-ref';
                            if (close >= ceil * 0.99) priceClass = 'price-ceil';
                            else if (close <= floor * 1.01) priceClass = 'price-floor';
                            else if (change > 0) priceClass = 'price-up';
                            else if (change < 0) priceClass = 'price-down';
                            
                            rows.push(`
                                <tr onclick="selectStock('${s.symbol}');document.querySelector('[data-page=dashboard]').click()">
                                    <td class="sticky-col" style="font-weight:700;color:${change>=0?'#00e676':'#ff1744'}">${s.symbol}</td>
                                    <td class="price-ref">${fmtPrice(ref)}</td>
                                    <td class="price-ceil">${fmtPrice(ceil)}</td>
                                    <td class="price-floor">${fmtPrice(floor)}</td>
                                    <td>${fmtPrice(open)}</td>
                                    <td class="price-up">${fmtPrice(high)}</td>
                                    <td class="price-down">${fmtPrice(low)}</td>
                                    <td class="${priceClass}" style="font-weight:700;">${fmtPrice(close)}</td>
                                    <td class="${priceClass}">${change>=0?'+':''}${(change*1000).toFixed(0)}</td>
                                    <td class="${priceClass}">${change>=0?'+':''}${pct.toFixed(2)}%</td>
                                    <td style="color:#64748b;">${fmtVol(vol)}</td>
                                    <td style="color:#64748b;font-size:0.75rem;">${date}</td>
                                </tr>
                            `);
                        }
                    }
                } catch(e) { console.error(s.symbol, e); }
            }
            
            if (rows.length) {
                tbody.innerHTML = rows.join('');
                const dateMsg = selectedDate 
                    ? `D·ªØ li·ªáu ng√†y ${new Date(dataDate).toLocaleDateString('vi-VN')}`
                    : `D·ªØ li·ªáu m·ªõi nh·∫•t (${dataDate})`;
                toast(`‚úì ƒê√£ t·∫£i ${rows.length} c·ªï phi·∫øu - ${dateMsg}`);
            } else {
                const noDataMsg = selectedDate 
                    ? `Kh√¥ng c√≥ d·ªØ li·ªáu cho ng√†y ${new Date(selectedDate).toLocaleDateString('vi-VN')}. C√≥ th·ªÉ l√† ng√†y ngh·ªâ/cu·ªëi tu·∫ßn.`
                    : 'Kh√¥ng c√≥ d·ªØ li·ªáu';
                tbody.innerHTML = `<tr><td colspan="12" style="text-align:center;color:var(--text-secondary);padding:40px;">${noDataMsg}<br><small>Th·ª≠ ch·ªçn ng√†y kh√°c</small></td></tr>`;
            }
        }

        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'Gi√°', data: [], borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.1)', fill: true, tension: 0.4, pointRadius: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { color: '#334155' }, ticks: { color: '#64748b' } }, y: { grid: { color: '#334155' }, ticks: { color: '#64748b', callback: v => fmtPrice(v) } } } }
            });
        }

        function updateChart(data) {
            priceChart.data.labels = data.map(d => d.date);
            priceChart.data.datasets[0].data = data.map(d => d.close);
            priceChart.update();
        }

        // Kh·ªüi t·∫°o ng√†y m·∫∑c ƒë·ªãnh
        let latestDataDate = null;
        async function initDates() {
            console.log('üìÖ initDates...');
            const today = new Date();
            const oneYearAgo = new Date();
            oneYearAgo.setFullYear(today.getFullYear() - 1);
            
            const toDateEl = document.getElementById('toDate');
            const fromDateEl = document.getElementById('fromDate');
            const marketDateEl = document.getElementById('marketDate');
            
            if (toDateEl) toDateEl.value = today.toISOString().split('T')[0];
            if (fromDateEl) fromDateEl.value = oneYearAgo.toISOString().split('T')[0];
            if (marketDateEl) marketDateEl.value = today.toISOString().split('T')[0];
            
            // L·∫•y ng√†y giao d·ªãch g·∫ßn nh·∫•t t·ª´ API
            try {
                const r = await fetch(API + '/api/prices/VNM?limit=1');
                const data = await r.json();
                if (data && data.length > 0 && data[0].date) {
                    latestDataDate = data[0].date;
                    if (marketDateEl) marketDateEl.value = data[0].date;
                    updateDataStatus(data[0].date);
                } else {
                    updateDataStatus(null);
                }
            } catch(e) {
                console.log('initDates error:', e);
                updateDataStatus(null);
            }
        }

        function updateDataStatus(dateStr) {
            const banner = document.getElementById('latestDataDate');
            const status = document.getElementById('dataStatus');
            const btn = document.getElementById('fetchLatestBtn');
            
            if (!dateStr) {
                banner.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                status.innerHTML = '<i class="fas fa-exclamation-circle"></i> Ch∆∞a c√≥';
                status.style.background = 'rgba(239,68,68,0.2)';
                status.style.color = '#ef4444';
                return;
            }
            
            const dataDate = new Date(dateStr);
            const today = new Date();
            const dayName = ['Ch·ªß nh·∫≠t','Th·ª© 2','Th·ª© 3','Th·ª© 4','Th·ª© 5','Th·ª© 6','Th·ª© 7'][dataDate.getDay()];
            banner.textContent = `${dayName}, ${dateStr}`;
            
            // T√≠nh s·ªë ng√†y ch√™nh l·ªách
            const diffDays = Math.floor((today - dataDate) / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 1 || (today.getDay() === 1 && diffDays <= 3)) {
                // D·ªØ li·ªáu m·ªõi (ho·∫∑c l√† th·ª© 2 v√† d·ªØ li·ªáu t·ª´ th·ª© 6)
                status.innerHTML = '<i class="fas fa-check-circle"></i> ƒê√£ c·∫≠p nh·∫≠t';
                status.style.background = 'rgba(16,185,129,0.2)';
                status.style.color = '#10b981';
            } else {
                status.innerHTML = `<i class="fas fa-clock"></i> ${diffDays} ng√†y tr∆∞·ªõc`;
                status.style.background = 'rgba(245,158,11,0.2)';
                status.style.color = '#f59e0b';
            }
        }

        async function fetchLatestData() {
            const btn = document.getElementById('fetchLatestBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang fetch...';
            toast('ƒêang fetch d·ªØ li·ªáu m·ªõi cho t·∫•t c·∫£ m√£...');
            
            try {
                const r = await fetch(API + '/api/data/fetch-all', { method: 'POST' });
                const d = await r.json();
                toast(`‚úì Fetch th√†nh c√¥ng! ${d.summary?.success || 0} m√£`);
                
                // Reload l·∫°i d·ªØ li·ªáu
                await initDates();
                loadStats();
                if (document.getElementById('page-market').classList.contains('active')) {
                    loadMarketTable();
                }
            } catch(e) {
                toast('L·ªói fetch: ' + e.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-cloud-download-alt"></i> Fetch d·ªØ li·ªáu m·ªõi';
            }
        }

        async function fetchCurrentStock() {
            if (!currentSymbol) return;
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            if (!fromDate || !toDate) { toast('Vui l√≤ng ch·ªçn ng√†y', 'error'); return; }
            toast(`ƒêang fetch ${currentSymbol} (${fromDate} ‚Üí ${toDate})...`);
            try {
                const r = await fetch(API + `/api/data/fetch/${currentSymbol}?from_date=${fromDate}&to_date=${toDate}`, { method: 'POST' });
                const d = await r.json();
                if (d.status === 'success') { toast(`‚úì ${d.records_added} records`); loadPrices(currentSymbol, days); loadStats(); }
                else toast(d.detail || d.message || 'Error', 'error');
            } catch(e) { toast(e.message, 'error'); }
        }

        async function fetchAllData() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            if (!fromDate || !toDate) { toast('Vui l√≤ng ch·ªçn ng√†y', 'error'); return; }
            toast(`ƒêang fetch t·∫•t c·∫£ (${fromDate} ‚Üí ${toDate})...`);
            try {
                const r = await fetch(API + `/api/data/fetch-all?from_date=${fromDate}&to_date=${toDate}`, { method: 'POST' });
                const d = await r.json();
                toast(`‚úì ${d.summary?.success||0} m√£ th√†nh c√¥ng`);
                loadStats(); loadMarketTable();
            } catch(e) { toast(e.message, 'error'); }
        }

        async function initDB() {
            toast('ƒêang kh·ªüi t·∫°o...');
            try {
                const r = await fetch(API + '/api/admin/init-db', { method: 'POST' });
                const d = await r.json();
                toast(d.status === 'success' ? `‚úì Th√™m ${d.stocks_added.length} m√£` : d.message);
                loadStocks(); loadStats();
            } catch(e) { toast(e.message, 'error'); }
        }

        async function runPredict() {
            const symbol = document.getElementById('predSymbol').value;
            const pdays = parseInt(document.getElementById('predDays').value);
            const model = document.getElementById('predModel').value;
            if (!symbol) { toast('Ch·ªçn m√£ CK', 'error'); return; }
            
            const btn = document.getElementById('predBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang ch·∫°y ML Models...';
            toast(`ƒêang ph√¢n t√≠ch ${symbol} v·ªõi c√°c m√¥ h√¨nh AI/ML...`);
            
            try {
                // Get price data for chart
                const cached = pricesCache[symbol] || [];
                const lastPrice = cached.length ? cached[cached.length-1].close : 50;
                
                // ================================================================
                // CALL UNIFIED PREDICTION API - Real ML Models (ARIMA, Prophet, LSTM, GRU, XGBoost)
                // ================================================================
                let unifiedData = null;
                let mlPredictions = [];
                let mlReasons = [];
                let confidence = 50;
                let direction = 'sideway';
                let finalPrice = lastPrice;
                let changePercent = 0;
                
                try {
                    // Determine which models to use based on dropdown
                    let modelsParam = 'all';
                    if (model && model !== 'ensemble') {
                        modelsParam = model;  // e.g., 'arima', 'prophet', 'lstm', 'gru'
                    }
                    
                    const unifiedUrl = `${API}/api/ml/unified/predict/${symbol}?days=${pdays}&models=${modelsParam}&include_sentiment=true&include_technicals=true`;
                    const unifiedR = await fetch(unifiedUrl);
                    unifiedData = await unifiedR.json();
                    
                    if (unifiedData.status === 'success') {
                        // Extract predictions from ML models
                        const ensemble = unifiedData.ensemble_prediction;
                        mlPredictions = ensemble.predictions.map(p => p.predicted_price);
                        finalPrice = ensemble.final_price;
                        changePercent = ensemble.total_change_percent;
                        
                        // Confidence from analysis
                        const analysis = unifiedData.analysis;
                        confidence = analysis.confidence * 100;
                        
                        // Direction
                        if (changePercent > 1) direction = 'up';
                        else if (changePercent < -1) direction = 'down';
                        else direction = 'sideway';
                        
                        // Build reasons from individual models
                        for (const [modelName, modelData] of Object.entries(unifiedData.individual_predictions)) {
                            if (modelData.metrics && !modelData.model_info.error) {
                                const modelPred = modelData.predictions[modelData.predictions.length - 1];
                                const modelChange = ((modelPred - lastPrice) / lastPrice * 100);
                                const modelType = modelChange > 0 ? 'positive' : modelChange < 0 ? 'negative' : 'neutral';
                                const modelIcon = {
                                    'arima': 'üìä', 'prophet': 'üîÆ', 'lstm': 'üß†', 'gru': 'üîÑ', 'xgboost': 'üöÄ'
                                }[modelName] || 'üìà';
                                
                                mlReasons.push({
                                    type: modelType,
                                    icon: modelIcon,
                                    text: `${modelData.model_info.name}: ${modelChange > 0 ? '+' : ''}${modelChange.toFixed(2)}%`,
                                    detail: `${modelData.model_info.description} - MAE: ${modelData.metrics.mae}, Weight: ${(modelData.weight_in_ensemble * 100).toFixed(1)}%`
                                });
                            }
                        }
                        
                        // Add sentiment reason if available
                        if (unifiedData.sentiment) {
                            const sent = unifiedData.sentiment;
                            const sentType = sent.average_score > 0.3 ? 'positive' : sent.average_score < -0.3 ? 'negative' : 'neutral';
                            mlReasons.push({
                                type: sentType,
                                icon: 'ü§ñ',
                                text: `FinBERT Sentiment: ${sent.interpretation}`,
                                detail: `Score: ${sent.average_score.toFixed(3)} (${sent.samples} tin t·ª©c) - ƒêi·ªÅu ch·ªânh ${sent.adjustment_percent}%`
                            });
                        }
                        
                        // Add technical indicators reason
                        if (unifiedData.technical_indicators) {
                            const tech = unifiedData.technical_indicators;
                            const techType = tech.trend === 'Uptrend' ? 'positive' : tech.trend === 'Downtrend' ? 'negative' : 'neutral';
                            mlReasons.push({
                                type: techType,
                                icon: 'üìâ',
                                text: `Technical: ${tech.trend} (RSI: ${tech.rsi.toFixed(0)})`,
                                detail: `SMA10: ${fmtPrice(tech.sma_10/1000)}, SMA30: ${fmtPrice(tech.sma_30/1000)} - ${tech.rsi_signal}`
                            });
                        }
                        
                        // Add recommendation reason
                        mlReasons.push({
                            type: analysis.recommendation.includes('BUY') ? 'positive' : analysis.recommendation.includes('SELL') ? 'negative' : 'neutral',
                            icon: 'üéØ',
                            text: `Khuy·∫øn ngh·ªã: ${analysis.recommendation}`,
                            detail: `ƒê·ªô tin c·∫≠y: ${analysis.confidence_level} (${confidence.toFixed(0)}%) - Models: ${analysis.models_used.join(', ')}`
                        });
                        
                        // Update FinBERT section
                        const finbertSection = document.getElementById('predFinbertSection');
                        if (unifiedData.sentiment) {
                            const fb = unifiedData.sentiment;
                            finbertSection.style.display = 'block';
                            const score = fb.average_score;
                            const scoreColor = score > 0.2 ? '#10b981' : score < -0.2 ? '#ef4444' : '#f59e0b';
                            const scoreLabel = fb.interpretation === 'Positive' ? 'üìà T√çCH C·ª∞C' : fb.interpretation === 'Negative' ? 'üìâ TI√äU C·ª∞C' : '‚û°Ô∏è TRUNG L·∫¨P';
                            document.getElementById('predFinbertScore').innerHTML = `
                                <span style="color:${scoreColor};font-weight:700;">${scoreLabel}</span>
                                <span style="font-size:0.9rem;opacity:0.7;"> (Score: ${score.toFixed(3)})</span>
                            `;
                            document.getElementById('predFbPos').textContent = '-';
                            document.getElementById('predFbNeu').textContent = fb.samples || 0;
                            document.getElementById('predFbNeg').textContent = '-';
                        } else {
                            finbertSection.style.display = 'none';
                        }
                        
                        console.log('‚úÖ ML Unified Prediction:', unifiedData);
                    } else {
                        throw new Error(unifiedData.detail || 'Unified prediction failed');
                    }
                } catch(mlError) {
                    console.warn('‚ö†Ô∏è ML Unified API error, falling back to basic prediction:', mlError);
                    
                    // Fallback: basic prediction if ML API fails
                    mlReasons.push({
                        type: 'neutral',
                        icon: '‚ö†Ô∏è',
                        text: 'Fallback: D·ª± ƒëo√°n c∆° b·∫£n',
                        detail: `ML API kh√¥ng kh·∫£ d·ª•ng: ${mlError.message}. S·ª≠ d·ª•ng ph∆∞∆°ng ph√°p d·ª± ph√≤ng.`
                    });
                    
                    // Simple fallback calculation
                    const prices = cached.map(d => d.close);
                    const sma5 = prices.length >= 5 ? prices.slice(-5).reduce((a,b) => a+b, 0) / 5 : lastPrice;
                    const sma20 = prices.length >= 20 ? prices.slice(-20).reduce((a,b) => a+b, 0) / 20 : lastPrice;
                    
                    if (lastPrice > sma5 && sma5 > sma20) {
                        direction = 'up';
                        mlReasons.push({ type: 'positive', icon: 'üìà', text: 'Golden Cross', detail: 'Gi√° > SMA5 > SMA20' });
                    } else if (lastPrice < sma5 && sma5 < sma20) {
                        direction = 'down';
                        mlReasons.push({ type: 'negative', icon: 'üìâ', text: 'Death Cross', detail: 'Gi√° < SMA5 < SMA20' });
                    }
                    
                    // Generate fallback predictions
                    let price = lastPrice;
                    const drift = direction === 'up' ? 0.005 : direction === 'down' ? -0.003 : 0.001;
                    for (let i = 1; i <= pdays; i++) {
                        price *= (1 + drift + (Math.random() - 0.5) * 0.01);
                        mlPredictions.push(price);
                    }
                    finalPrice = mlPredictions[mlPredictions.length - 1];
                    changePercent = ((finalPrice - lastPrice) / lastPrice * 100);
                    confidence = 40; // Lower confidence for fallback
                }
                
                // Generate chart data
                const labels = [], actual = [], pred = [];
                cached.slice(-30).forEach(d => { labels.push(d.date); actual.push(d.close); pred.push(null); });
                
                // QUAN TR·ªåNG: T·∫°o ƒë∆∞·ªùng d·ª± ƒëo√°n v·ªõi bi·∫øn ƒë·ªông t·ª± nhi√™n (s√≥ng)
                const lastActualPrice = actual[actual.length - 1];
                pred[pred.length - 1] = lastActualPrice; // ƒêi·ªÉm n·ªëi
                
                // T·∫°o ƒë∆∞·ªùng d·ª± ƒëo√°n v·ªõi bi·∫øn ƒë·ªông nh∆∞ s√≥ng (kh√¥ng ph·∫£i ƒë∆∞·ªùng th·∫≥ng)
                if (mlPredictions.length > 0) {
                    // Calculate volatility from historical data (last 20 days)
                    const recentPrices = cached.slice(-20).map(d => d.close);
                    let volatility = 0.02; // Default 2%
                    if (recentPrices.length > 1) {
                        const returns = [];
                        for (let i = 1; i < recentPrices.length; i++) {
                            returns.push((recentPrices[i] - recentPrices[i-1]) / recentPrices[i-1]);
                        }
                        volatility = Math.sqrt(returns.reduce((sum, r) => sum + r*r, 0) / returns.length);
                    }
                    
                    // Overall trend: from lastActualPrice to finalPrice
                    const overallTrend = (finalPrice - lastActualPrice) / mlPredictions.length;
                    
                    // Generate wave-like predictions with natural fluctuations
                    let currentPrice = lastActualPrice;
                    for (let i = 0; i < mlPredictions.length; i++) {
                        const dt = new Date(); 
                        dt.setDate(dt.getDate() + i + 1);
                        labels.push(dt.toISOString().split('T')[0]);
                        actual.push(null);
                        
                        // Add trend component
                        currentPrice += overallTrend;
                        
                        // Add wave component (sine wave for natural oscillation)
                        const waveFreq = 0.5; // Wave frequency
                        const waveAmplitude = currentPrice * volatility * 0.7; // Wave amplitude based on volatility
                        const wave = Math.sin(i * waveFreq) * waveAmplitude;
                        
                        // Add random noise for realism
                        const noise = (Math.random() - 0.5) * currentPrice * volatility * 0.3;
                        
                        // Combine: trend + wave + noise
                        let predictedPrice = currentPrice + wave + noise;
                        
                        // Ensure price doesn't deviate too much from trend
                        const maxDeviation = currentPrice * volatility * 2;
                        const trendPrice = lastActualPrice + overallTrend * (i + 1);
                        if (Math.abs(predictedPrice - trendPrice) > maxDeviation) {
                            predictedPrice = trendPrice + (predictedPrice > trendPrice ? maxDeviation : -maxDeviation);
                        }
                        
                        // Ensure price is positive
                        predictedPrice = Math.max(predictedPrice, lastActualPrice * 0.5);
                        
                        pred.push(predictedPrice);
                        currentPrice = predictedPrice; // Use this as base for next iteration
                    }
                    
                    // Ensure last prediction matches target (smooth ending)
                    const lastPredIdx = pred.length - 1;
                    if (pred[lastPredIdx] !== null && Math.abs(pred[lastPredIdx] - finalPrice) > finalPrice * 0.05) {
                        // Gradually adjust last few points to reach target
                        const adjustSteps = Math.min(3, mlPredictions.length);
                        for (let i = 0; i < adjustSteps; i++) {
                            const idx = lastPredIdx - i;
                            if (idx > 30 && pred[idx] !== null) { // Don't adjust actual data
                                const ratio = (adjustSteps - i) / adjustSteps;
                                const adjustment = (finalPrice - pred[lastPredIdx]) * ratio / adjustSteps;
                                pred[idx] += adjustment;
                            }
                        }
                    }
                } else {
                    // Fallback n·∫øu kh√¥ng c√≥ predictions
                    for (let i = 0; i < 7; i++) {
                        const dt = new Date(); 
                        dt.setDate(dt.getDate() + i + 1);
                        labels.push(dt.toISOString().split('T')[0]);
                        actual.push(null);
                        pred.push(lastActualPrice);
                    }
                }
                
                // Get news for display
                let sentimentData = null;
                try {
                    const newsR = await fetch(`${API}/api/news/${symbol}`);
                    sentimentData = await newsR.json();
                } catch(e) { console.log('News fetch error:', e); }
                
                // Update UI - Summary
                const directionEl = document.getElementById('predDirection');
                if (direction === 'up') {
                    directionEl.innerHTML = `<span style="color:#10b981;">üöÄ D·ª∞ ƒêO√ÅN TƒÇNG +${changePercent.toFixed(1)}%</span>`;
                } else if (direction === 'down') {
                    directionEl.innerHTML = `<span style="color:#ef4444;">üìâ D·ª∞ ƒêO√ÅN GI·∫¢M ${changePercent.toFixed(1)}%</span>`;
                } else {
                    directionEl.innerHTML = `<span style="color:#f59e0b;">‚û°Ô∏è D·ª∞ ƒêO√ÅN ƒêI NGANG</span>`;
                }
                
                document.getElementById('predPriceRange').innerHTML = `
                    Gi√° hi·ªán t·∫°i: <strong>${fmtPrice(lastPrice)}</strong> ‚Üí 
                    D·ª± ƒëo√°n sau ${pdays} ng√†y: <strong>${fmtPrice(finalPrice)}</strong>
                `;
                
                document.getElementById('predConfidence').innerHTML = `
                    <span style="color:${confidence > 70 ? '#10b981' : confidence > 50 ? '#f59e0b' : '#ef4444'};">
                        ${confidence.toFixed(0)}%
                    </span>
                `;
                
                // Update UI - Reasons (using mlReasons from ML API)
                document.getElementById('reasonsList').innerHTML = mlReasons.map(r => `
                    <div style="display:flex;align-items:flex-start;gap:12px;padding:12px;background:var(--bg-card);border-radius:8px;border-left:3px solid ${r.type === 'positive' ? '#10b981' : r.type === 'negative' ? '#ef4444' : '#94a3b8'};">
                        <span style="font-size:1.5rem;">${r.icon}</span>
                        <div>
                            <div style="font-weight:600;color:${r.type === 'positive' ? '#10b981' : r.type === 'negative' ? '#ef4444' : 'var(--text-primary)'};">${r.text}</div>
                            <div style="font-size:0.85rem;color:var(--text-secondary);margin-top:4px;">${r.detail}</div>
                        </div>
                    </div>
                `).join('');
                
                // Update UI - Related News
                if (sentimentData?.news?.length) {
                    document.getElementById('predNewsList').innerHTML = sentimentData.news.slice(0, 3).map(n => `
                        <a href="${n.url || '#'}" target="_blank" rel="noopener" style="display:block;text-decoration:none;color:inherit;padding:10px;background:var(--bg-card);border-radius:8px;border-left:3px solid ${n.sentiment === 'positive' ? '#10b981' : n.sentiment === 'negative' ? '#ef4444' : '#94a3b8'};transition:all 0.2s;" onmouseover="this.style.background='rgba(59,130,246,0.15)'" onmouseout="this.style.background='var(--bg-card)'">
                            <div style="font-weight:500;font-size:0.9rem;">${n.title} <i class="fas fa-external-link-alt" style="font-size:0.65rem;opacity:0.5;"></i></div>
                            <div style="font-size:0.75rem;color:var(--text-secondary);margin-top:4px;">${n.source} ‚Ä¢ ${n.published_at}</div>
                        </a>
                    `).join('');
                } else {
                    document.getElementById('predNewsList').innerHTML = '<div style="color:var(--text-secondary);font-size:0.9rem;">Kh√¥ng c√≥ tin t·ª©c li√™n quan</div>';
                }
                
                // Update Chart
                if (!predChart) {
                    predChart = new Chart(document.getElementById('predChart').getContext('2d'), {
                        type: 'line',
                        data: { labels, datasets: [
                            { label: 'Th·ª±c t·∫ø', data: actual, borderColor: '#3b82f6', tension: 0.4, pointRadius: 2 }, 
                            { label: 'D·ª± ƒëo√°n', data: pred, borderColor: direction === 'up' ? '#10b981' : direction === 'down' ? '#ef4444' : '#f59e0b', borderDash: [5,5], tension: 0.4, pointRadius: 2 }
                        ]},
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { x: { grid: { color: '#334155' }, ticks: { color: '#64748b' } }, y: { grid: { color: '#334155' }, ticks: { color: '#64748b', callback: v => fmtPrice(v) } } } }
                    });
                } else {
                    predChart.data.labels = labels;
                    predChart.data.datasets[0].data = actual;
                    predChart.data.datasets[1].data = pred;
                    predChart.data.datasets[1].borderColor = direction === 'up' ? '#10b981' : direction === 'down' ? '#ef4444' : '#f59e0b';
                    predChart.update();
                }
                
                document.getElementById('predResult').style.display = 'block';
                toast(`‚úì D·ª± ƒëo√°n ${symbol} ho√†n t·∫•t`);
                
            } catch(e) {
                toast('L·ªói: ' + e.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-play"></i> Ch·∫°y d·ª± ƒëo√°n';
            }
        }

        function fmtPrice(p) { return p == null ? '--' : new Intl.NumberFormat('vi-VN').format(p * 1000) + ' VND'; }
        function fmtVol(v) { return v == null ? '--' : v >= 1e6 ? (v/1e6).toFixed(1)+'M' : v >= 1e3 ? (v/1e3).toFixed(0)+'K' : v; }
        function formatNum(n) { return n >= 1e6 ? (n/1e6).toFixed(1)+'M' : n >= 1e3 ? (n/1e3).toFixed(1)+'K' : n; }
        function toast(msg, type='success') { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast' + (type==='error'?' error':''); t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000); }

        // =====================================================
        // NEWS PAGE FUNCTIONS
        // =====================================================
        
        let allNewsData = [];
        
        async function loadNewsData() {
            const tbody = document.getElementById('newsTableBody');
            tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:40px;"><i class="fas fa-spinner fa-spin" style="font-size:2rem;color:var(--accent);"></i><p style="margin-top:16px;color:var(--text-secondary);">ƒêang t·∫£i tin t·ª©c...</p></td></tr>';
            
            try {
                // Fetch news from API (limit 50 for 3 days - faster)
                const response = await fetch(`${API}/api/news?limit=50`);
                const data = await response.json();
                
                if (data.status === 'success' && data.news) {
                    // Filter last 3 days
                    const threeDaysAgo = new Date();
                    threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                    
                    allNewsData = data.news.filter(news => {
                        const newsDate = parseNewsDate(news.published_at);
                        return newsDate >= threeDaysAgo;
                    });
                    
                    // Populate symbol filter
                    populateNewsSymbolFilter();
                    
                    // Render table
                    renderNewsTable();
                } else {
                    throw new Error(data.detail || 'Kh√¥ng th·ªÉ t·∫£i tin t·ª©c');
                }
            } catch (e) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;padding:40px;color:var(--danger);"><i class="fas fa-exclamation-circle" style="font-size:2rem;"></i><p style="margin-top:16px;">L·ªói: ${e.message}</p></td></tr>`;
                toast('L·ªói t·∫£i tin t·ª©c', 'error');
            }
        }
        
        function parseNewsDate(dateStr) {
            // Parse "DD/MM/YYYY HH:MM" or "YYYY-MM-DD" format
            if (dateStr.includes('/')) {
                const [datePart, timePart] = dateStr.split(' ');
                const [day, month, year] = datePart.split('/');
                return new Date(year, month - 1, day);
            } else {
                return new Date(dateStr);
            }
        }
        
        function populateNewsSymbolFilter() {
            const select = document.getElementById('newsSymbolFilter');
            const symbols = [...new Set(allNewsData.map(n => n.symbol).filter(s => s))].sort();
            
            // Keep "T·∫•t c·∫£ m√£" option and add symbols
            const currentValue = select.value;
            select.innerHTML = '<option value="">T·∫•t c·∫£ m√£</option>' + 
                symbols.map(s => `<option value="${s}">${s}</option>`).join('');
            select.value = currentValue;
        }
        
        function renderNewsTable() {
            const tbody = document.getElementById('newsTableBody');
            const symbolFilter = document.getElementById('newsSymbolFilter').value;
            const sentimentFilter = document.getElementById('newsSentimentFilter').value;
            
            // Apply filters
            let filteredNews = allNewsData;
            
            if (symbolFilter) {
                filteredNews = filteredNews.filter(n => n.symbol === symbolFilter);
            }
            
            if (sentimentFilter) {
                filteredNews = filteredNews.filter(n => n.sentiment === sentimentFilter);
            }
            
            // Update count
            document.getElementById('newsCount').textContent = filteredNews.length;
            
            if (filteredNews.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:40px;color:var(--text-secondary);"><i class="fas fa-inbox" style="font-size:2rem;opacity:0.3;"></i><p style="margin-top:16px;">Kh√¥ng c√≥ tin t·ª©c</p></td></tr>';
                return;
            }
            
            // Render rows
            tbody.innerHTML = filteredNews.map((news, index) => {
                const sentimentColors = {
                    positive: {bg: 'var(--success-light)', text: 'var(--success)', icon: 'üìà'},
                    negative: {bg: 'var(--danger-light)', text: 'var(--danger)', icon: 'üìâ'},
                    neutral: {bg: 'rgba(148,163,184,0.15)', text: 'var(--text-secondary)', icon: '‚û°Ô∏è'}
                };
                const sc = sentimentColors[news.sentiment] || sentimentColors.neutral;
                
                const relevancePercent = news.relevance_score !== undefined ? 
                    (news.relevance_score * 100).toFixed(0) : '--';
                
                return `
                    <tr style="border-bottom:1px solid var(--border);">
                        <td style="text-align:center;color:var(--text-muted);font-size:0.8rem;">${index + 1}</td>
                        <td>
                            <div style="font-weight:500;margin-bottom:4px;">${news.title}</div>
                            ${news.summary ? `<div style="font-size:0.75rem;color:var(--text-secondary);line-height:1.4;">${news.summary.substring(0, 100)}${news.summary.length > 100 ? '...' : ''}</div>` : ''}
                        </td>
                        <td style="text-align:center;">
                            ${news.symbol ? `<span style="padding:4px 8px;background:var(--accent-light);color:var(--accent);border-radius:6px;font-weight:600;font-size:0.8rem;">${news.symbol}</span>` : '--'}
                        </td>
                        <td style="font-size:0.8rem;">${news.source}</td>
                        <td style="font-size:0.8rem;color:var(--text-secondary);">${news.published_at}</td>
                        <td>
                            <span style="padding:4px 10px;background:${sc.bg};color:${sc.text};border-radius:6px;font-size:0.75rem;font-weight:600;display:inline-flex;align-items:center;gap:4px;">
                                ${sc.icon} ${news.sentiment}
                            </span>
                        </td>
                        <td style="text-align:center;font-weight:600;color:${news.sentiment_score > 0 ? 'var(--success)' : news.sentiment_score < 0 ? 'var(--danger)' : 'var(--text-secondary)'};">
                            ${news.sentiment_score > 0 ? '+' : ''}${news.sentiment_score.toFixed(2)}
                        </td>
                        <td style="text-align:center;">
                            ${relevancePercent !== '--' ? `<span style="font-weight:600;color:var(--purple);">${relevancePercent}%</span>` : '--'}
                        </td>
                        <td style="text-align:center;">
                            ${news.url ? `<a href="${news.url}" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none;"><i class="fas fa-external-link-alt"></i></a>` : '--'}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function exportNewsCSV() {
            const symbolFilter = document.getElementById('newsSymbolFilter').value;
            const sentimentFilter = document.getElementById('newsSentimentFilter').value;
            
            let filteredNews = allNewsData;
            if (symbolFilter) filteredNews = filteredNews.filter(n => n.symbol === symbolFilter);
            if (sentimentFilter) filteredNews = filteredNews.filter(n => n.sentiment === sentimentFilter);
            
            if (filteredNews.length === 0) {
                toast('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ export', 'error');
                return;
            }
            
            // Create CSV
            const headers = ['STT', 'Ti√™u ƒë·ªÅ', 'M√£ CK', 'Ngu·ªìn', 'Th·ªùi gian', 'Sentiment', 'Score', 'Li√™n quan %', 'URL'];
            const rows = filteredNews.map((n, i) => [
                i + 1,
                `"${n.title.replace(/"/g, '""')}"`,
                n.symbol || '',
                n.source,
                n.published_at,
                n.sentiment,
                n.sentiment_score,
                n.relevance_score !== undefined ? (n.relevance_score * 100).toFixed(0) : '',
                n.url || ''
            ]);
            
            const csv = [headers, ...rows].map(row => row.join(',')).join('\\n');
            
            // Download
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `news_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            toast('‚úì ƒê√£ export CSV');
        }
    </script>
</body>
</html>
